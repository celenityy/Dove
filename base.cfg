// Lightningdove Thunderbird Mozilla.cfg

// Built from Phoenix (Hardened)

// defaultPref("browser.aboutConfig.showWarning", false);
defaultPref("general.warnOnAboutConfig", false);

// 001 DATA COLLECTION

// A lot of defense in depth...

/// WebVTT Testing Events
// https://searchfox.org/mozilla-central/source/modules/libpref/init/StaticPrefList.yaml

lockPref("media.webvtt.testing.events", false);

/// Origin Trials
// https://wiki.mozilla.org/Origin_Trials

lockPref("dom.origin-trials.enabled", false);

/// Crash Reporting
// https://github.com/mozilla-services/socorro
// https://wiki.mozilla.org/Socorro

lockPref("breakpad.reportURL", "");
// lockPref("browser.crashReports.unsubmittedCheck.autoSubmit2", false);
// lockPref("browser.crashReports.unsubmittedCheck.enabled", false);
// lockPref("browser.tabs.crashReporting.includeURL", false); // Defense in depth
// lockPref("browser.tabs.crashReporting.sendReport", false);

/// X-Frame Options Error Reporting
// https://firefox-source-docs.mozilla.org/toolkit/components/telemetry/data/xfocsp-error-report-ping.html

lockPref("security.xfocsp.errorReporting.automatic", false); // [DEFAULT]
lockPref("security.xfocsp.errorReporting.enabled", false);

/// SSL Error Reporting 
// https://mozilla.github.io/policy-templates/#preferences

lockPref("security.ssl.errorReporting.enabled", false);

/// Coverage [INVESTIGATE IF THIS APPLIES TO THUNDERBIRD]
// https://blog.mozilla.org/data/2018/08/20/effectively-measuring-search-in-firefox/

lockPref("toolkit.coverage.enabled", false);
lockPref("toolkit.coverage.endpoint.base", "");
lockPref("toolkit.coverage.opt-out", true); // [HIDDEN]
lockPref("toolkit.telemetry.coverage.opt-out", true); // [HIDDEN]

/// Default Browser Agent [INVESTIGATE IF THIS APPLIES TO THUNDERBIRD]
/// We also configure "DisableDefaultBrowserAgent" in policies
// https://mozilla.github.io/policy-templates/#disabledefaultbrowseragent
// https://firefox-source-docs.mozilla.org/toolkit/mozapps/defaultagent/default-browser-agent/index.html

lockPref("default-browser-agent.enabled", false);

/// Misc. Telemetry
/// We also configure "DisableTelemetry" & "ImproveSuggest" in policies 
// https://mozilla.github.io/policy-templates/#disabletelemetry 
// https://mozilla.github.io/policy-templates/#firefoxsuggest
// https://searchfox.org/mozilla-central/source/testing/geckodriver/src/prefs.rs
// https://wiki.mozilla.org/QA/Telemetry
// https://firefox-source-docs.mozilla.org/toolkit/components/telemetry/internals/preferences.html 
// https://searchfox.org/mozilla-central/source/modules/libpref/init/StaticPrefList.yaml
// https://searchfox.org/mozilla-central/source/remote/shared/RecommendedPreferences.sys.mjs
// https://searchfox.org/mozilla-central/source/testing/profiles/perf/user.js

// lockPref("browser.newtabpage.activity-stream.feeds.telemetry", false);
// lockPref("browser.newtabpage.activity-stream.impressionId", "");
// lockPref("browser.newtabpage.activity-stream.telemetry", false);
// lockPref("browser.newtabpage.activity-stream.telemetry.structuredIngestion.endpoint", "");
// lockPref("browser.newtabpage.activity-stream.telemetry.ut.events", false);
// lockPref("browser.places.interactions.enabled", false); // https://searchfox.org/mozilla-central/source/browser/app/profile/firefox.js
// lockPref("browser.privacySegmentation.preferences.show", false);
// lockPref("browser.rights.3.shown", true);
// lockPref("browser.search.serpEventTelemetryCategorization.enabled", false);
// lockPref("browser.search.serpMetricsRecordedCounter", 0);
// lockPref("browser.urlbar.quicksuggest.dataCollection.enabled", false);
// lockPref("corroborator.enabled", false);
lockPref("datareporting.healthreport.documentServerURI", ""); // [HIDDEN]
lockPref("datareporting.healthreport.logging.consoleEnabled", false); // [HIDDEN]
lockPref("datareporting.healthreport.service.enabled", false); // [HIDDEN]
lockPref("datareporting.healthreport.service.firstRun", false); // [HIDDEN]
lockPref("datareporting.healthreport.uploadEnabled", false);
lockPref("datareporting.policy.dataSubmissionEnabled", false);
lockPref("datareporting.policy.dataSubmissionPolicyAccepted", false);
lockPref("datareporting.policy.dataSubmissionPolicyBypassNotification", true);
lockPref("datareporting.policy.firstRunURL", "");
lockPref("dom.ipc.processHangMonitor", false);
lockPref("dom.ipc.reportProcessHangs", false);
lockPref("dom.security.unexpected_system_load_telemetry_enabled", false);
lockPref("hangmonitor.timeout", 0); // [BIRD: INVESTIGATE]
lockPref("network.jar.record_failure_reason", false); // [DEFAULT]
lockPref("network.traffic_analyzer.enabled", false);
lockPref("network.trr.confirmation_telemetry_enabled", false);
// lockPref("identity.fxaccounts.telemetry.clientAssociationPing.enabled", false);
// lockPref("identity.fxaccounts.account.telemetry.sanitized_uid", "");
lockPref("privacy.trackingprotection.emailtracking.data_collection.enabled", false);
// lockPref("security.app_menu.recordEventTelemetry", false);
// lockPref("security.certerrors.recordEventTelemetry", false);
// lockPref("security.protectionspopup.recordEventTelemetry", false);
lockPref("toolkit.content-background-hang-monitor.disabled", true);
lockPref("toolkit.telemetry.archive.enabled", false);
lockPref("toolkit.telemetry.bhrPing.enabled", false);
lockPref("toolkit.telemetry.cachedClientID", "");
lockPref("toolkit.telemetry.dap_enabled", false);
lockPref("toolkit.telemetry.dap_helper", "");
lockPref("toolkit.telemetry.dap_helper_owner", "");
lockPref("toolkit.telemetry.dap_leader", "");
lockPref("toolkit.telemetry.dap_leader_owner", "");
lockPref("toolkit.telemetry.dap_task1_enabled", false);
lockPref("toolkit.telemetry.dap_task1_taskid", "");
lockPref("toolkit.telemetry.dap_visit_counting_enabled", false);
lockPref("toolkit.telemetry.dap_visit_counting_experiment_list", "[]");
lockPref("toolkit.telemetry.debugSlowSql", false);
lockPref("toolkit.telemetry.enabled", false);
lockPref("toolkit.telemetry.firstShutdownPing.enabled", false);
lockPref("toolkit.telemetry.healthping.enabled", false);
lockPref("toolkit.telemetry.newProfilePing.enabled", false);
lockPref("toolkit.telemetry.pioneerId", ""); // [HIDDEN]
lockPref("toolkit.telemetry.previousBuildID", "");
lockPref("toolkit.telemetry.server", "data;");
lockPref("toolkit.telemetry.server_owner", "");
lockPref("toolkit.telemetry.shutdownPingSender.enabled", false);
lockPref("toolkit.telemetry.shutdownPingSender.enabledFirstSession", false);
lockPref("toolkit.telemetry.shutdownPingSender.backgroundtask.enabled", false);
lockPref("toolkit.telemetry.testing.suppressPingsender", true);
lockPref("toolkit.telemetry.unified", false);
lockPref("toolkit.telemetry.updatePing.enabled", false);
lockPref("toolkit.telemetry.user_characteristics_ping.opt-out", true);
lockPref("toolkit.telemetry.user_characteristics_ping.send-once", false);
lockPref("toolkit.telemetry.user_characteristics_ping.uuid", "");

/// Misc. UX - Harmless but does not apply to us

// lockPref("app.normandy.shieldLearnMoreUrl", "");
lockPref("datareporting.healthreport.infoURL", "");
lockPref("toolkit.crashreporter.infoURL", "");
lockPref("toolkit.datacollection.infoURL", "");

// 002 MOZILLA CRAPâ„¢

/// Firefox Recommendations & "Discovery"
// We also set "ExtensionRecommendations" & "FeatureRecommendations" in policies
// https://mozilla.github.io/policy-templates/#usermessaging
// https://support.mozilla.org/kb/recommendations-firefox
// https://support.mozilla.org/kb/personalized-extension-recommendations

// lockPref("browser.dataFeatureRecommendations.enabled", false);
// lockPref("browser.discovery.enabled", false);
// lockPref("browser.discovery.sites", "");
// lockPref("browser.newtabpage.activity-stream.asrouter.userprefs.cfr.addons", false);
// lockPref("browser.newtabpage.activity-stream.asrouter.userprefs.cfr.features", false);
// lockPref("extensions.getAddons.browseAddons", ""); // Android
lockPref("extensions.getAddons.discovery.api_url", "data:;base64,eyJyZXN1bHRzIjpbXX0%3D"); // https://searchfox.org/mozilla-central/source/testing/profiles/common/user.js
lockPref("extensions.getAddons.showPane", false);
// lockPref("extensions.htmlaboutaddons.discover.enabled", false); [BIRD: INVESTIGATE]
lockPref("extensions.htmlaboutaddons.recommendations.enabled", false);
lockPref("extensions.recommendations.themeRecommendationUrl", ""); // [BIRD: DEFAULT]
lockPref("extensions.webservice.discoverURL", "");

/// Fakespot

// lockPref("browser.shopping.experience2023.ads.enabled", false);
// lockPref("browser.shopping.experience2023.ads.exposure", false);
// lockPref("browser.shopping.experience2023.ads.userEnabled", false);
// lockPref("browser.shopping.experience2023.active", false);
// lockPref("browser.shopping.experience2023.autoOpen.enabled", false);
// lockPref("browser.shopping.experience2023.autoOpen.userEnabled", false);
// lockPref("browser.shopping.experience2023.enabled", false);
// lockPref("browser.shopping.experience2023.optedIn", 2);
// lockPref("browser.shopping.experience2023.survey.enabled", false);
// lockPref("browser.urlbar.fakespot.featureGate", false);
// lockPref("browser.urlbar.suggest.fakespot", false);
lockPref("toolkit.shopping.ohttpConfigURL", "");
lockPref("toolkit.shopping.ohttpRelayURL", "");

/// Firefox Relay

lockPref("signon.firefoxRelay.base_url", "");
// lockPref("signon.firefoxRelay.feature", "disabled");
lockPref("signon.firefoxRelay.learn_more_url", "");
lockPref("signon.firefoxRelay.manage_url", "");
lockPref("signon.firefoxRelay.privacy_policy_url", "");
lockPref("signon.firefoxRelay.terms_of_service_url", "");

/// Mozilla Push & Web Notifications
/// I have yet to see a legitimate use-case for websites using push notifications... but I have very commonly seen it abused for malicious purposes & spam
/// We also set "Notifications" in policies
// https://mozilla.github.io/policy-templates/#permissions
// https://mozilla-push-service.readthedocs.io/en/latest/
// https://mozilla-services.github.io/autopush-rs/

lockPref("dom.push.enabled", true); // [DEFAULT] - Fingerprintable & unnecessary with prefs below
lockPref("dom.push.connection.enabled", false);
lockPref("dom.push.serverURL", "");
lockPref("dom.push.userAgentID", "");
// lockPref("permissions.default.desktop-notification", 2);

/// Disable fetching AMO Metadata, used for recommendations & details, unnecessary
// https://support.mozilla.org/kb/how-stop-firefox-making-automatic-connections#w_add-on-metadata-updating

lockPref("extensions.getAddons.cache.enabled", false);

/// Prevent Mozilla domains from having special privileges
// https://firefox-source-docs.mozilla.org/dom/ipc/process_model.html#privileged-mozilla-content

lockPref("browser.tabs.remote.separatePrivilegedMozillaWebContentProcess", false); // [BIRD: DEFAULT]
lockPref("browser.tabs.remote.separatedMozillaDomains", "");
lockPref("dom.ipc.processCount.privilegedmozilla", 0);
defaultPref("extensions.webextensions.restrictedDomains", "");
lockPref("permissions.manager.defaultsUrl", "");
lockPref("privacy.resistFingerprinting.block_mozAddonManager", true);
lockPref("svg.context-properties.content.allowed-domains", ""); // [BIRD: DEFAULT]
// lockPref("webchannel.allowObject.urlWhitelist", "");

// 003 Search & URL Bar

/// Prevent search engines from remotely updating
// https://firefox-source-docs.mozilla.org/toolkit/search/Preferences.html#hidden

lockPref("browser.search.update", false);

/// Allow using a different search engine in Private Windows vs. Normal Windows [INVESTIGATE THUNDERBIRD IMPACT]

defaultPref("browser.search.separatePrivateDefault.ui.enabled", true);

/// Always show Punycode - Helps prevent phishing & IDN Homograph Attacks
// https://en.wikipedia.org/wiki/IDN_homograph_attack

lockPref("network.IDN_show_punycode", true);

// 004 Implicit Connections

/// Disable Network Prefetching
// We also set "NetworkPrediction" in policies
// https://mozilla.github.io/policy-templates/#networkprediction
// https://developer.mozilla.org/docs/Glossary/Prefetch

// lockPref("browser.places.speculativeConnect.enabled", false);
// lockPref("browser.urlbar.speculativeConnect.enabled", false);
lockPref("network.dns.disablePrefetch", true);
lockPref("network.dns.disablePrefetchFromHTTPS", true);
lockPref("network.http.speculative-parallel-limit", 0);
lockPref("network.predictor.enable-prefetch", false); // [DEFAULT]
lockPref("network.predictor.enabled", false);
lockPref("network.prefetch-next", false);

/// Disable Search Suggestions
/// We also set "SearchSuggestEnabled" in policies
// https://mozilla.github.io/policy-templates/#searchsuggestenabled

lockPref("browser.search.suggest.enabled", false);
lockPref("browser.search.suggest.enabled.private", false); // [BIRD: DEFAULT]
// lockPref("browser.urlbar.showSearchSuggestionsFirst", false);
// lockPref("browser.urlbar.suggest.searches", false);

// 005 HTTP(S) - Mixed Content & General Network Hardening

/// Enforce using HTTPS as much as possible

lockPref("dom.security.https_first", true);
lockPref("dom.security.https_first_pbm", true); // [DEFAULT]
lockPref("dom.security.https_first_schemeless", true);
lockPref("dom.security.https_only_mode", true);
lockPref("dom.security.https_only_mode.upgrade_local", true);
lockPref("dom.security.https_only_mode_pbm", true);
lockPref("security.mixed_content.block_active_content", true);
lockPref("security.mixed_content.block_display_content", true);
lockPref("security.mixed_content.upgrade_display_content", true); // [BIRD: DEFAULT]
lockPref("security.mixed_content.upgrade_display_content.audio", true); // [DEFAULT]
lockPref("security.mixed_content.upgrade_display_content.image", true); // [DEFAULT]
lockPref("security.mixed_content.upgrade_display_content.video", true); // [DEFAULT]

/// Show suggestions when an HTTPS page can not be found 

defaultPref("dom.security.https_only_mode_error_page_user_suggestions", true);

/// Always warn on insecure webpages

// lockPref("security.insecure_connection_text.enabled", true);
// lockPref("security.insecure_connection_text.pbmode.enabled", true);
lockPref("security.ssl.treat_unsafe_negotiation_as_broken", true);
lockPref("security.warn_submit_secure_to_insecure", true); // Warn when submitting a form from HTTP to HTTPS

/// Show detailed information on insecure warning pages

lockPref("browser.xul.error_pages.expert_bad_cert", true);

/// Disable TLS1.3 0-RTT (Not forward secret)
// https://github.com/tlswg/tls13-spec/issues/1001

lockPref("security.tls.enable_0rtt_data", false);

/// Enforce preloading intermediates
// https://wiki.mozilla.org/Security/CryptoEngineering/Intermediate_Preloading

lockPref("security.remote_settings.intermediates.enabled", true); // [DEFAULT]

/// Never downgrade to insecure TLS 1.0/1.1

lockPref("security.tls.insecure_fallback_hosts", ""); // [DEFAULT]
lockPref("security.tls.version.enable-deprecated", false); // [DEFAULT]

/// Enforce TLS 1.3 downgrade protection
// https://bugzilla.mozilla.org/show_bug.cgi?id=1576790

lockPref("security.tls.hello_downgrade_check", true); // [DEFAULT]

/// Only load secure websockets from HTTPS pages

lockPref("network.websocket.allowInsecureFromHTTPS", false); // [DEFAULT]

/// Enforce blocking additional ports [INVESTIGATE IF IMPACTS BIRD]

lockPref("network.security.ports.banned.override", ""); // [DEFAULT]

/// Enable Post Quantum Key Agreement (Kyber)
/// We also set "PostQuantumKeyAgreementEnabled" in policies
// https://mozilla.github.io/policy-templates/#postquantumkeyagreementenabled

lockPref("network.http.http3.enable_kyber", true);
lockPref("security.tls.enable_kyber", true);

/// Disable Captive Portal & Connectivity Checks
// We also set "CaptivePortal" in policies
// https://support.mozilla.org/kb/how-stop-firefox-making-automatic-connections#w_network-detection
// https://www.eff.org/deeplinks/2017/08/how-captive-portals-interfere-wireless-security-and-privacy

lockPref("captivedetect.canonicalURL", "");
lockPref("network.captive-portal-service.enabled", false); // [BIRD: DEFAULT]
lockPref("network.connectivity-service.enabled", false);
lockPref("network.connectivity-service.IPv4.url", "");
lockPref("network.connectivity-service.IPv6.url", "");

/// Proxy
// We also set "UseProxyForDNS" in policies
// https://mozilla.github.io/policy-templates/#proxy

lockPref("network.file.disable_unc_paths", true);
lockPref("network.gio.supported-protocols", "");
lockPref("network.proxy.socks_remote_dns", true);
lockPref("network.proxy.socks5_remote_dns", true);

// 006 DNS

/// We also set "DNSOverHTTPS" in policies
// https://mozilla.github.io/policy-templates/#dnsoverhttps

/// Disable Mozilla DOH Rollout

// lockPref("doh-rollout.disable-heuristics", true);
// lockPref("doh-rollout.enabled", false);
// lockPref("doh-rollout.uri", "");
lockPref("network.trr.default_provider_uri", "");

/// Enable DoH & Set to Quad9 by default
/// We also set "DNSOverHTTPS" in policies
// https://mozilla.github.io/policy-templates/#dnsoverhttps

defaultPref("network.trr.custom_uri", "https://dns.quad9.net/dns-query");
defaultPref("network.trr.mode", 3);
defaultPref("network.trr.uri", "https://dns.quad9.net/dns-query");

/// Skip DoH Connectivity Checks

lockPref("network.trr.confirmationNS", "skip");

/// Never disable DoH from registry checks
// https://searchfox.org/mozilla-central/source/modules/libpref/init/StaticPrefList.yaml

lockPref("network.notify.checkForNRPT", false);
lockPref("network.notify.checkForProxies", false);

/// Enforce EncryptedClientHello
// We also set "DisableEncryptedClientHello" in policies
// https://mozilla.github.io/policy-templates/#disableencryptedclienthello
// https://blog.cloudflare.com/announcing-encrypted-client-hello

lockPref("network.dns.echconfig.enabled", true); // [DEFAULT]
lockPref("network.dns.http3_echconfig.enabled", true); // [DEFAULT]

/// Enable Native DNS HTTPS Lookups

lockPref("network.dns.native_https_query", true);

// 007 CERTIFICATES

/// Enforce OCSP & Stapling

lockPref("security.OCSP.enabled", 1); // [DEFAULT]
lockPref("security.ssl.enable_ocsp_must_staple", true); // [DEFAULT]
lockPref("security.ssl.enable_ocsp_stapling", true); // [DEFAULT]

/// Enable CRLite & use where possible

lockPref("security.pki.crlite_mode", 2);
lockPref("security.remote_settings.crlite_filters.enabled", true);

/// Enforce Strict Public Key Pinning

lockPref("security.cert_pinning.enforcement_level", 2);

// 008 DOWNLOADS

/// Always prompt before downloading files
/// We also set "PromptForDownloadLocation" in policies
// https://mozilla.github.io/policy-templates/#promptfordownloadlocation

lockPref("browser.download.always_ask_before_handling_new_types", true);
lockPref("browser.download.useDownloadDir", false); // [BIRD: DEFAULT]

// Enforce blocking insecure downloads

lockPref("dom.block_download_insecure", true); // [DEFAULT]

// 009 SAFE BROWSING

/// Prevent sending metadata of downloaded files to Google
// https://support.mozilla.org/kb/how-does-phishing-and-malware-protection-work#w_how-does-phishing-and-malware-protection-work-in-firefox
// https://feeding.cloud.geek.nz/posts/how-safe-browsing-works-in-firefox/

lockPref("browser.safebrowsing.downloads.remote.enabled", false);
lockPref("browser.safebrowsing.downloads.remote.url", "");

/// Enforce that no data is shared with Google
// https://bugzilla.mozilla.org/show_bug.cgi?id=1351147

lockPref("browser.safebrowsing.provider.google.dataSharing.enabled", false); // [DEFAULT] Android
lockPref("browser.safebrowsing.provider.google4.dataSharing.enabled", false); // [DEFAULT]
lockPref("browser.safebrowsing.provider.google4.dataSharingURL", "");

// 010 GEOLOCATION

/// Prevent Wi-Fi Scanning

lockPref("browser.region.network.scan", false); // [DEFAULT]
lockPref("geo.wifi.scan", false); [INVESTIGATE]

/// Disable "Region Updates" & Geo Targetting
// https://firefox-source-docs.mozilla.org/toolkit/modules/toolkit_modules/Region.html
// https://support.mozilla.org/kb/how-stop-firefox-making-automatic-connections#w_geolocation-for-default-search-engine

lockPref("browser.region.local-geocoding", false);
lockPref("browser.region.network.url", "");
lockPref("browser.region.update.enabled", false);
lockPref("browser.search.geoip.url", "");
lockPref("browser.search.region", "US");

/// Deny websites geo permission by default
/// We also set "Location" in policies
// https://mozilla.github.io/policy-templates/#permissions

// defaultPref("permissions.default.geo", 2);

/// Geo Provider

// The discontinuation of the Mozilla Location Service puts us in a very tricky situation here...

// I am not willing to expose the geolocation of my users to Google or Microsoft.
// This means that for the time being, Windows & Linux users will not have geolocation support by default.
// Hopefully an alternative solution can be found here in the future.

defaultPref("geo.provider.network.url", "");
defaultPref("geo.provider.use_corelocation", true); // Allow Apple Location Services for macOS
defaultPref("geo.provider.use_geoclue", true); // Allow Geoclue for Linux distros
defaultPref("geo.provider.use_gpsd", true); // Allow GPSd for Linux distros
defaultPref("geo.provider.ms-windows-location", false); // Disable Microsoft Location Services for Windows users

// 011 WEBRTC

lockPref("media.peerconnection.ice.obfuscate_host_addresses", true);
lockPref("media.peerconnection.ice.proxy_only_if_behind_proxy", true);
lockPref("privacy.webrtc.allowSilencingNotifications", true);
defaultPref("privacy.webrtc.globalMuteToggles", true);
lockPref("privacy.webrtc.hideGlobalIndicator", false);
lockPref("privacy.webrtc.sharedTabWarning", true);

// 012 DISK AVOIDANCE

/// Disable Search & Form History - Can be leaked to sites
// We also set "DisableFormHistory" in policies
// https://mozilla.github.io/policy-templates/#disableformhistory
// https://blog.mindedsecurity.com/2011/10/autocompleteagain.html

lockPref("browser.formfill.enable", false);

/// Prevent syncing history by default

defaultPref("services.sync.engine.history", false);

/// Disable caching, might reconsider since we clear cache on exit anyways

defaultPref("browser.cache.disk.enable", false);
defaultPref("browser.cache.disk_cache_ssl", false);
defaultPref("browser.cache.memory.enable", false);
defaultPref("browser.cache.memory.capacity", 0);
lockPref("browser.privatebrowsing.forceMediaMemoryCache", true);

/// Sanitize on exit
// We also configure "SanitizeOnShutdown" in policies
// https://mozilla.github.io/policy-templates/#sanitizeonshutdown-selective

// lockPref("privacy.clearHistory.cache", true);
// defaultPref("privacy.clearHistory.historyFormDataAndDownloads", true);
// lockPref("privacy.clearSiteData.cache", true);
// defaultPref("privacy.clearSiteData.historyFormDataAndDownloads", true);
lockPref("privacy.clearOnShutdown.cache", true);
// defaultPref("privacy.clearOnShutdown.cookies", true); // Set "cookiebanners.service.mode" to 1 if you override
// defaultPref("privacy.clearOnShutdown.downloads", true);
// lockPref("privacy.clearOnShutdown.formdata", true);
// defaultPref("privacy.clearOnShutdown.history", true);
// defaultPref("privacy.clearOnShutdown.offlineApps", true);
// lockPref("privacy.clearOnShutdown.sessions", true);
lockPref("privacy.clearOnShutdown_v2.cache", true);
// defaultPref("privacy.clearOnShutdown_v2.cookiesAndStorage", true); // Set "cookiebanners.service.mode" to 1 if you override
// defaultPref("privacy.clearOnShutdown_v2.historyFormDataAndDownloads", true);
lockPref("privacy.cpd.cache", true);
// lockPref("privacy.cpd.formdata", true);
lockPref("privacy.sanitize.sanitizeOnShutdown", true); // Allows selectively clearing data on shutdown

/// Set time range when manually clearing data to "everything"

lockPref("privacy.sanitize.timeSpan", 0);

/// Prevent logging blocked domains in about:protections

// lockPref("browser.contentblocking.cfr-milestone.enabled", false);
lockPref("browser.contentblocking.database.enabled", false); // [BIRD: DEFAULT]

/// Delete cached files from windows opened with external applications
/// We also set "StartDownloadsInTempDirectory" in policies
// https://mozilla.github.io/policy-templates/#startdownloadsintempdirectory

lockPref("browser.download.start_downloads_in_tmp_dir", true);
lockPref("browser.helperApps.deleteTempFileOnExit", true);

/// Prevent automatically starting Firefox & restoring session after reboot on Windows [INVESTIGATE BIRD IMPACT]

lockPref("toolkit.winRegisterApplicationRestart", false);

/// Prevent coloring visited links

lockPref("layout.css.visited_links_enabled", false);

/// Disable collecting & generating background thumbnails

lockPref("browser.pagethumbnails.capturing_disabled", true); // [HIDDEN]

// 013 EXTENSIONS

// Only allow signed extensions

lockPref("extensions.langpacks.signatures.required", true);
lockPref("xpinstall.signatures.required", true);
lockPref("xpinstall.whitelist.required", true); // {DEFAULT}

// Enforce Extension Blocklist

lockPref("extensions.blocklist.enabled", true); // [DEFAULT]

// Allow LocalCDN to work on quarantined domains

defaultPref("extensions.quarantineIgnoredByUser.{b86e4813-687a-43e6-ab65-0bde4ab75758}", true);

// Allow Mullvads extension to work on quarantined domains

defaultPref("extensions.quarantineIgnoredByUser.{d19a89b9-76c1-4a61-bcd4-49e8de916403}", true);

// 014 PDF.js

/// Disable JavaScript

lockPref("pdfjs.enableScripting", false);

/// Never allow documents to prevent copying text
/// We also set `EnablePermissions` in policies
// https://mozilla.github.io/policy-templates/#pdfjs

lockPref("pdfjs.enablePermissions", false); // [DEFAULT]

/// Never open Microsoft Edge for PDFs
// https://searchfox.org/mozilla-central/source/modules/libpref/init/StaticPrefList.yaml

lockPref("browser.pdf.launchDefaultEdgeAsApp", false);

/// Open PDFs in browser where possible

defaultPref("browser.download.open_pdf_attachments_inline", true);

/// Show sidebar by default when viewing PDFs

defaultPref("pdfjs.sidebarViewOnLoad", 2);

// 015 FINGERPRINTING PROTECTION

/// Enforce US English as locale by default

lockPref("intl.accept_languages", "en-US, en");
lockPref("intl.locale.requested", "en-US");
lockPref("privacy.spoof_english", 2);

/// Round window sizes

lockPref("privacy.window.maxInnerHeight", 900);
lockPref("privacy.window.maxInnerWidth", 1600);

/// Disable WebGPU
// https://browserleaks.com/webgpu

lockPref("dom.webgpu.enabled", false); // [DEFAULT]

/// Enforce that WebGL stays disabled if it is disabled

lockPref("webgl.disable-fail-if-major-performance-caveat", false);

/// Prevent using system colors

lockPref("browser.display.use_system_colors", false);

// 016 MISC. PRIVACY

/// Enforce Do Not Track & Global Privacy Control

lockPref("privacy.donottrackheader.enabled", true);
lockPref("privacy.globalprivacycontrol.enabled", true);
lockPref("privacy.globalprivacycontrol.functionality.enabled", true);
lockPref("privacy.globalprivacycontrol.pbmode.enabled", true);

/// Disable "Privacy-Preserving Attribution"
// https://support.mozilla.org/kb/privacy-preserving-attribution

lockPref("dom.origin-trials.private-attribution.state", 0);
lockPref("dom.private-attribution.submission.enabled", false);

/// Disable Reporting API
// https://w3c.github.io/reporting/
// https://bugzilla.mozilla.org/show_bug.cgi?id=1492036

lockPref("dom.reporting.enabled", false); // [DEFAULT]
lockPref("dom.reporting.crash.enabled", false);
lockPref("dom.reporting.featurePolicy.enabled", false);
lockPref("dom.reporting.header.enabled", false);

/// Trim cross-origin referers (Like Safari)

lockPref("network.http.referer.XOriginTrimmingPolicy", 2);

/// Restrict referers for trackers

lockPref("network.http.referer.defaultPolicy.trackers", 1);
lockPref("network.http.referer.defaultPolicy.trackers.pbmode", 1);

/// Disable Hyperlink Auditing (Click Tracking)
// https://www.bleepingcomputer.com/news/software/major-browsers-to-prevent-disabling-of-click-tracking-privacy-risk/

lockPref("browser.send_pings", false); // [DEFAULT]

/// Improve built-in query stripping to be on par with LibreWolf & Brave
// https://codeberg.org/librewolf/settings/src/branch/master/librewolf.cfg#L77

defaultPref("privacy.query_stripping.strip_list", "__hsfp __hssc __hstc __s _hsenc _openstat dclid fbclid gbraid gclid hsCtaTracking igshid mc_eid ml_subscriber ml_subscriber_hash msclkid oft_c oft_ck oft_d oft_id oft_ids oft_k oft_lk oft_sk oly_anon_id oly_enc_id rb_clickid s_cid twclid vero_conv vero_id wbraid wickedid yclid");

// 017 PASSWORDS & AUTHENTICATION

/// Never Autofill

lockPref("signon.autofillForms", false);
lockPref("signon.autofillForms.http", false); // [DEFAULT]
lockPref("signon.formlessCapture.enabled", false);
lockPref("signon.privateBrowsingCapture.enabled", false);

/// Always allow showing password when hidden

defaultPref("layout.forms.reveal-password-button.enabled", true);
defaultPref("layout.forms.reveal-password-context-menu.enabled", true); // [DEFAULT]

/// Prevent websites from dictating whether to allow filling passwords
// https://blog.0xbadc0de.be/archives/124

lockPref("signon.storeWhenAutocompleteOff", false);

/// Never truncate passwords
// https://www.ghacks.net/2020/05/18/firefox-77-wont-truncate-text-exceeding-max-length-to-address-password-pasting-issues/

lockPref("editor.truncate_user_pastes", false);

/// Enable strong password generation by default

defaultPref("signon.generation.enabled", true); // [DEFAULT]

/// Prevent cross-origin sub-resources from opening HTTP authentication dialogs

lockPref("network.auth.subresource-http-auth-allow", 1);

/// Disable Windows SSO
/// We also configure "WindowsSSO" in policies
// https://mozilla.github.io/policy-templates/#windowssso

lockPref("network.http.windows-sso.enabled", false); // [DEFAULT]

/// Prevent using Negotiate authentication by default 
// https://people.redhat.com/mikeb/negotiate/

defaultPref("network.negotiate-auth.trusted-uris", ""); // [DEFAULT]

/// Enforce crashing on insecure password input

lockPref("intl.allow-insecure-text-input", false); // [DEFAULT]

// 019 ATTACK SURFACE REDUCTION

/// Disable JavaScript Just-in-time Compilation (JIT)
// https://microsoftedge.github.io/edgevr/posts/Super-Duper-Secure-Mode/

lockPref("javascript.options.baselinejit", false);
lockPref("javascript.options.ion", false);
lockPref("javascript.options.native_regexp", false); //  https://gitlab.torproject.org/tpo/applications/tor-browser/-/issues/21865 https://searchfox.org/mozilla-central/source/modules/libpref/init/StaticPrefList.yaml
lockPref("javascript.options.wasm_baselinejit", false);

/// Disable ASM.JS
// https://rh0dev.github.io/blog/2017/the-return-of-the-jit/

lockPref("javascript.options.asmjs", false);

/// Disable MathML
// https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=mathml 

lockPref("mathml.disabled", true);

/// Disable Graphite & SVG OpenType fonts
// https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=firefox+graphite
// https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=firefox+svg

lockPref("gfx.font_rendering.graphite.enabled", false);
lockPref("gfx.font_rendering.opentype_svg.enabled", false);

// 022 MISC. SECURITY

/// Disable Accessibility Services
// https://support.mozilla.org/en-US/kb/accessibility-services#w_malware-and-adware

lockPref("accessibility.force_disabled", 1);
lockPref("devtools.accessibility.enabled", false);

/// Enforce that Content Analysis is disabled
/// We also set "ContentAnalysis" in policies
// https://mozilla.github.io/policy-templates/#contentanalysis
// https://github.com/chromium/content_analysis_sdk

lockPref("browser.contentanalysis.default_result", 0); // [DEFAULT]
lockPref("browser.contentanalysis.enabled", false); // [DEFAULT]

/// Prevent disabling important security features
/// Yes, this is a real pref.
// https://searchfox.org/mozilla-central/source/testing/profiles/common/user.js

lockPref("security.turn_off_all_security_so_that_viruses_can_take_over_this_computer", false); // [DEFAULT]

/// Enforce Site Isolation & Isolate all websites

lockPref("dom.ipc.processCount.webIsolated", 1);
lockPref("fission.autostart", true); // [DEFAULT]

/// Enable GPU Sandboxing
// https://www.ghacks.net/2023/01/17/firefox-110-will-launch-with-gpu-sandboxing-on-windows/

lockPref("security.sandbox.gpu.level", 1);

/// Disable GNOME Integration [INVESTIGATE BIRD IMPACT]
// https://searchfox.org/mozilla-central/source/browser/components/shell/nsGNOMEShellService.cpp

lockPref("browser.gnome-search-provider.enabled", false);

/// Protect against CSRF Attacks (Like Chromium)
// https://web.dev/articles/samesite-cookies-explained
// https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions

lockPref("network.cookie.sameSite.laxByDefault", true);
lockPref("network.cookie.sameSite.noneRequiresSecure", true);
lockPref("network.cookie.sameSite.schemeful", true);

/// Enforce Strict file:// Origin Policy
// https://stuffandnonsense.co.uk/blog/firefoxs_file_uri_origin_policy_and_web_fonts
// https://stackoverflow.com/questions/2856502/css-font-face-not-working-with-firefox-but-working-with-chrome-and-ie

lockPref("security.fileuri.strict_origin_policy", true); // [DEFAULT]

/// Always protect against MIME Exploits
// https://www.pcmag.com/encyclopedia/term/mime-exploit

lockPref("security.block_fileuri_script_with_wrong_mime", true);
lockPref("security.block_Worker_with_wrong_mime", true); // [DEFAULT]

/// Never load Navigator Media Objects & getUserMedia Support in insecure contexts
// https://developer.mozilla.org/docs/Web/API/Navigator/mediaDevices
// https://searchfox.org/mozilla-central/source/modules/libpref/init/StaticPrefList.yaml

lockPref("media.devices.insecure.enabled", false); // [DEFAULT]
lockPref("media.getusermedia.insecure.enabled", false); // [DEFAULT]

// 023 BLOCK COOKIE BANNERS

defaultPref("cookiebanners.service.mode", 2); // Set this to 1 if you override & choose to save cookies
defaultPref("cookiebanners.service.mode.privateBrowsing", 2);
// defaultPref("cookiebanners.ui.desktop.enabled", true);

// 024 MEDIA

/// Enforce validating signature for GMP when updating
// https://searchfox.org/mozilla-central/source/modules/libpref/init/all.js

lockPref("media.gmp-manager.cert.checkAttributes", true); // [DEFAULT]
lockPref("media.gmp-manager.cert.requireBuiltIn", true); // [DEFAULT]
lockPref("media.gmp-manager.checkContentSignature", true); // [DEFAULT]

/// Disable Autoplay by default

defaultPref("media.autoplay.default", 5);
defaultPref("userContent.player.click_to_play", true); // https://github.com/black7375/Firefox-UI-Fix/wiki/Options#defaults-6

/// DRM
// Garbage technology with freedom, privacy, & security concerns
// We also set "EncryptedMediaExtensions" in policies
// https://mozilla.github.io/policy-templates/#encryptedmediaextensions

// lockPref("browser.eme.ui.enabled", false);
lockPref("media.eme.enabled", false);
// lockPref("media.gmp-widevinecdm.enabled", false);
// lockPref("media.gmp-widevinecdm.visible", false);
// lockPref("media.gmp-widevinecdm-l1.enabled", false);
// lockPref("media.gmp-widevinecdm-l1.visible", false);

// 025 UPDATES

/// Browser Updates

defaultPref("app.update.badgeWaitTime", 0); // Immediately show badge on hamburger menu when update is available
defaultPref("app.update.notifyDuringDownload", true); // Ensure that users are notified when an update is downloaded
defaultPref("app.update.promptWaitTime", 3600); // Decrease time between update prompts, default is very generous...

/// Enforce Extension Updates
/// We also set "ExtensionUpdate" in policies
// https://mozilla.github.io/policy-templates/#extensionupdate

lockPref("extensions.systemAddon.update.enabled", true); // [DEFAULT]
lockPref("extensions.update.autoUpdateDefault", true); // [DEFAULT]
lockPref("extensions.update.enabled", true); // [DEFAULT]
// lockPref("media.gmp-manager.updateEnabled", true);

// 026 DEBUGGING

/// Enforce local debugging only

lockPref("devtools.debugger.force-local", true);
lockPref("devtools.debugger.prompt-connection", true);
lockPref("devtools.debugger.remote-enabled", false);
lockPref("devtools.inspector.remote", false);

/// Ensure that URLs are not being logged in Reader errors

lockPref("reader.errors.includeURLs", false);

/// 027 MISC.

/// Enable Containers & isolate permissions per container

lockPref("permissions.isolateBy.userContext", true);
defaultPref("privacy.userContext.enabled", true);
// defaultPref("privacy.userContext.ui.enabled", true);

/// Force pop-up windows to open in new tabs instead

lockPref("browser.link.open_newwindow", 3); // [DEFAULT]
lockPref("browser.link.open_newwindow.restriction", 0); // [BIRD: DEFAULT]

/// Always block pop-ups by default
/// We also configure "PopupBlocking" in policies
// https://mozilla.github.io/policy-templates/#popupblocking

defaultPref("dom.disable_open_during_load", true);

/// Limit what events can cause pop-ups

defaultPref("dom.popup_allowed_events", "click dblclick");

/// Prevent scripts from moving, resizing, and messing with windows

lockPref("dom.disable_window_flip", true); // {DEFAULT}
lockPref("dom.disable_window_move_resize", true);

/// Disable annoying Web Speech API errors

lockPref("media.webspeech.synth.dont_notify_on_error", true);

// 028 PERFORMANCE
// https://github.com/yokoffing/Betterfox/blob/main/Fastfox.js

defaultPref("browser.cache.disk.metadata_memory_limit", 500);
defaultPref("browser.cache.jsbc_compression_level", 3);
defaultPref("browser.sessionstore.max_tabs_undo", 7);
defaultPref("browser.sessionhistory.max_total_viewers", 7);
defaultPref("browser.sessionstore.interval", 60000);
defaultPref("browser.tabs.min_inactive_duration_before_unload", 300000);
defaultPref("browser.toolbars.bookmarks.visibility", "always");
defaultPref("content.notify.interval", 100000); // https://searchfox.org/mozilla-central/rev/c1180ea13e73eb985a49b15c0d90e977a1aa919c/modules/libpref/init/StaticPrefList.yaml#1824-1834
defaultPref("dom.enable_web_task_scheduling", true);  // https://blog.mozilla.org/performance/2022/06/02/prioritized-task-scheduling-api-is-prototyped-in-nightly/
defaultPref("gfx.canvas.accelerated.cache-items", 4096);
defaultPref("gfx.canvas.accelerated.cache-size", 512);
defaultPref("gfx.content.skia-font-cache-size", 20);
defaultPref("gfx.webrender.all", true);
defaultPref("gfx.webrender.compositor", true);
defaultPref("gfx.webrender.compositor.force-enabled", true);
defaultPref("image.mem.decode_bytes_at_a_time", 32768);
defaultPref("image.mem.shared.unmap.min_expiration_ms", 120000);
defaultPref("layout.css.grid-template-masonry-value.enabled", true); // https://developer.mozilla.org/docs/Web/CSS/CSS_Grid_Layout/Masonry_Layout
defaultPref("media.cache_readahead_limit", 7200);
defaultPref("media.cache_resume_threshold", 3600);
defaultPref("network.buffer.cache.count", 128);
defaultPref("network.buffer.cache.size", 262144);
defaultPref("network.dnsCacheEntries", 1000);
defaultPref("network.dnsCacheExpiration", 3600);
defaultPref("network.dnsCacheExpirationGracePeriod", 240);
defaultPref("network.http.max-connections", 1800);
defaultPref("network.http.max-persistent-connections-per-proxy", 48);
defaultPref("network.http.max-persistent-connections-per-server", 10);
defaultPref("network.http.max-urgent-start-excessive-connections-per-host", 5);
defaultPref("media.memory_cache_max_size", 65536);
defaultPref("network.ssl_tokens_cache_capacity", 10240);

// 029 SMOOTH SCROLLING

defaultPref("general.smoothScroll", true);
defaultPref("general.smoothScroll.currentVelocityWeighting", "1.0");
defaultPref("general.smoothScroll.msdPhysics.continuousMotionMaxDeltaMS", 12);
defaultPref("general.smoothScroll.msdPhysics.enabled", true);
defaultPref("general.smoothScroll.msdPhysics.motionBeginSpringConstant", 600);
defaultPref("general.smoothScroll.msdPhysics.regularSpringConstant", 650);
defaultPref("general.smoothScroll.msdPhysics.slowdownMinDeltaMS", 25);
defaultPref("general.smoothScroll.msdPhysics.slowdownMinDeltaRatio", "2.0");
defaultPref("general.smoothScroll.msdPhysics.slowdownSpringConstant", 250);
defaultPref("general.smoothScroll.stopDecelerationWeighting", "1.0");
defaultPref("mousewheel.default.delta_multiplier_y", 300);

// Personal Touch ðŸ’œ

/// Things that are  nice to haveâ„¢

// defaultPref("browser.bookmarks.autoExportHTML", true);
// defaultPref("browser.bookmarks.openInTabClosesMenu", false);
// defaultPref("browser.compactmode.show", true);
// defaultPref("browser.menu.showViewImageInfo", true);
// defaultPref("browser.newtabpage.activity-stream.feeds.places", false);
// defaultPref("browser.newtabpage.activity-stream.discoverystream.recentSaves.enabled", false);
// defaultPref("browser.newtabpage.activity-stream.improvesearch.handoffToAwesomebar", false);
// defaultPref("browser.newtabpage.activity-stream.newtabWallpapers.enabled", true);
// defaultPref("browser.newtabpage.activity-stream.newtabWallpapers.v2.enabled", true);
// defaultPref("browser.newtabpage.activity-stream.feeds.section.highlights", false);
// defaultPref("browser.newtabpage.activity-stream.section.highlights.includeBookmarks", false);
// defaultPref("browser.newtabpage.activity-stream.section.highlights.includeDownloads", false);
// defaultPref("browser.newtabpage.activity-stream.section.highlights.includeVisited", false);
// defaultPref("browser.newtabpage.activity-stream.section.highlights.rows", 0);
// defaultPref("browser.newtabpage.activity-stream.showRecentSaves", false);
// defaultPref("browser.preferences.experimental", true);
// defaultPref("browser.privateWindowSeparation.enabled", false);
// defaultPref("browser.search.openintab", true);
// defaultPref("browser.tabs.loadBookmarksInTabs", true);
// defaultPref("browser.tabs.tabmanager.enabled", false);
defaultPref("browser.translations.alwaysTranslateLanguages", "fr,de,bg,ca,nl,et,fi,el,hu,it,pl,ru,pt,sl,es,tr,uk");
defaultPref("browser.translations.automaticallyPopup", true); // [DEFAULT]
defaultPref("browser.translations.enable", true); // [DEFAULT]
defaultPref("browser.translations.newSettingsUI.enable", true);
defaultPref("browser.translations.select.enable", true); // [DEFAULT]
// defaultPref("browser.urlbar.openintab", true);
defaultPref("devtools.debugger.ui.editor-wrapping", true);
defaultPref("findbar.highlightAll", true);
defaultPref("full-screen-api.transition-duration.enter", "0 0");
defaultPref("full-screen-api.warning.delay", -1);
defaultPref("full-screen-api.warning.timeout", 0);
// defaultPref("browser.mailto.dualPrompt", false); // Prevent prompting to use as mailto handler
// defaultPref("browser.mailto.prompt.os", false); // Prevent prompting to use as mailto handler
defaultPref("toolkit.legacyUserProfileCustomizations.stylesheets", true);
defaultPref("toolkit.zoomManager.zoomValues", ".3,.5,.67,.8,.9,.95,1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,2,2.4,3,4,5");
defaultPref("view_source.wrap_long_lines", true);

// Misc.

// lockPref("identity.fxaccounts.migrateToDevEdition", false);
// defaultPref("media.gmp-gmpopenh264.enabled", false);
// lockPref("permissions.default.shortcuts", 2);
// lockPref("screenshots.browser.component.enabled", false);
lockPref("services.sync.engine.creditcards", false);
lockPref("services.sync.engine.creditcards.available", false);
lockPref("services.sync.engine.passwords", false);

// Dev stuff :p 

defaultPref("devtools.aboutdebugging.showHiddenAddons", true);
defaultPref("devtools.command-button-measure.enabled", true);
defaultPref("devtools.command-button-rulers.enabled", true);
defaultPref("devtools.command-button-screenshot.enabled", true);
defaultPref("devtools.dom.enabled", true);

// DO NOT TOUCH

lockPref("beacon.enabled", true); // [DEFAULT] - Useless & fingerprintable, the websites can get the data from this API anyways...
lockPref("dom.webaudio.enabled", true); // [DEFAULT] - Useless & does more harm than good, covered by FPP/RFP
lockPref("dom.webnotifications.enabled", true); // [DEFAULT] - Notifications are locked behind a permission prompt (Which we block anyways), unnecessary & fingerprintable
lockPref("geo.enabled", true); // [DEFAULT] - Geolocation is locked behind a permission prompt (Which we block anyways), unnecessary & fingerprintable
lockPref("media.navigator.enabled", true); // [DEFAULT] - Useless & does more harm than good, covered by FPP/RFP
lockPref("media.ondevicechange.enabled", true); // [DEFAULT] - Useless & does more harm than good, covered by FPP/RFP
lockPref("media.peerconnection.enabled", true); // [DEFAULT] - Only necessary to disable on Android, uses mDNS Host Obfuscation on desktop & Private IP is only exposed in trusted scenarios
lockPref("media.video_stats.enabled", true); // [DEFAULT] - Useless & does more harm than good, covered by FPP/RFP
lockPref("media.webspeech.synth.enabled", true); // [DEFAULT] - Useless & does more harm than good, covered by FPP/RFP
lockPref("privacy.firstparty.isolate", false); // [DEFAULT] - Deprecated, covered by TCP/ETP
lockPref("ui.use_standins_for_native_colors", false); // [DEFAULT] - Useless & does more harm than good, covered by FPP/RFP
lockPref("webgl.enable-debug-renderer-info", true); // [DEFAULT] - Useless & does more harm than good, covered by FPP/RFP

/// ATTRIBUTION

// Credit to the following projects for making this possible, thank you.

// https://github.com/arkenfox/user.js
// https://github.com/yokoffing/Betterfox
// https://librewolf.net/
// https://codeberg.org/divested/brace
// https://codeberg.org/rusty-snake/firefox-config
// https://codeberg.org/Narsil/mozilla.cfg// We can do better.

// This is what I generally use for my primary profile & browsing needs. 

// Some of these will be configured as "pref", which allows overriding if needed, but resets on next launch.

// 001 NETWORKING

// Require safe renegotiations - Disables RFC 5746

pref("security.ssl.require_safe_negotiation", true);

// 002 FINGERPRINTING PROTECTION

/// Enable RFP (resistFingerprinting)
// https://github.com/arkenfox/user.js/blob/master/user.js#L745

pref("privacy.resistFingerprinting", true);
pref("privacy.resistFingerprinting.letterboxing", true);

/// Disable FPP Overrides/WebCompat

lockPref("privacy.fingerprintingProtection.remoteOverrides.enabled", false);

/// Disable WebGL
// https://blog.browserscan.net/docs/webgl-fingerprinting
// https://security.stackexchange.com/questions/13799/is-webgl-a-security-concern

pref("webgl.disabled", true);

/// 003 WEBRTC

// Never leak IP address - This *will* break WebRTC

lockPref("media.peerconnection.ice.default_address_only", true);
lockPref("media.peerconnection.ice.no_host", true);

// 004 MISC. PRIVACY

/// Disable ETP WebCompat & Heuristics

pref("privacy.antitracking.enableWebcompat", false);
pref("privacy.restrict3rdpartystorage.heuristic.opened_window_after_interaction", false);
pref("privacy.restrict3rdpartystorage.heuristic.recently_visited", false);
pref("privacy.restrict3rdpartystorage.heuristic.redirect", false);
pref("privacy.restrict3rdpartystorage.heuristic.window_open", false);

/// Only send cross-origin referers if hosts match

pref("network.http.referer.XOriginPolicy", 2);

/// Never sync Browser History

lockPref("services.sync.engine.history", false);

// 005 PASSWORDS & AUTHENTICATION

/// Kill Browser Password Manager

// lockPref("browser.contentblocking.report.endpoint_url", "");
// lockPref("browser.contentblocking.report.lockwise.enabled", false);
// lockPref("browser.contentblocking.report.lockwise.how_it_works.url", "");
// lockPref("browser.contentblocking.report.mobile-android.url", "");
// lockPref("browser.contentblocking.report.mobile-ios.url", "");
// lockPref("browser.contentblocking.report.monitor.enabled", false);
// lockPref("browser.contentblocking.report.monitor.home_page_url", "");
// lockPref("browser.contentblocking.report.monitor.how_it_works.url", "");
// lockPref("browser.contentblocking.report.monitor.preferences_url", "");
// lockPref("browser.contentblocking.report.monitor.sign_in_url", "");
// lockPref("browser.contentblocking.report.monitor.url", "");
lockPref("extensions.formautofill.addresses.enabled", false);
lockPref("extensions.formautofill.creditCards.enabled", false);
lockPref("pref.privacy.disable_button.view_passwords", true); [INVESTIGATE BIRD IMPACT]
// lockPref("privacy.cpd.passwords", true);
lockPref("signon.generation.enabled", false);
lockPref("signon.rememberSignons", false);
lockPref("signon.recipes.remoteRecipes.enabled", false);
lockPref("services.passwordSavingEnabled", false);
lockPref("services.sync.engine.passwords", false);
// lockPref("signon.management.page.breach-alerts.enabled", false);
// lockPref("signon.management.page.breachAlertUrl", "");
// lockPref("signon.management.page.vulnerable-passwords.enabled", false);

// 006 ATTACK SURFACE REDUCTION

/// Disable WebAssembly
// https://spectrum.ieee.org/more-worries-over-the-security-of-web-assembly

defaultPref("javascript.options.wasm", false);

// 007 MISC. SECURITY

/// Prevent sending HTTP requests to websites that do not respond quickly to check if they support HTTPS

defaultPref("dom.security.https_only_mode_send_http_background_request", false);

// 008 MISC.

/// Prevent sites from automatically refreshing

defaultPref("accessibility.blockautorefresh", true);
defaultPref("browser.meta_refresh_when_inactive.disabled", true);

/// Stricter Autoplay Blocking

defaultPref("media.autoplay.blocking_policy", 2);


/// Unleash the lightning and the dove that follows.

// 001 TELEMETRY

lockPref("toolkit.telemetry.ecosystemtelemetry.enabled", false); // [DEFAULT]

/// UI Instrumentation [INVESTIGATE IF STILL ACTIVE]
// https://kb.mozillazine.org/Thunderbird_5.0_-_New_Features_and_Changes

lockPref("mail.instrumentation.askUser", false);
lockPref("mail.instrumentation.postUrl", "");
lockPref("mail.instrumentation.userOptedIn", false);

// 002 MOZILLA CRAP

/// Disable Mozilla Email Provisioner/Creating new email addresses with their "partners"

lockPref("mail.provider.enabled", false);

/// Never check default mail client

lockPref("mail.shell.checkDefaultClient", false);

/// Skip Onboarding

lockPref("mail.rights.override", true);
lockPref("mailnews.start_page_override.mstone", "ignore");

/// Disable Donate Page

lockPref("app.donation.eoy.url", "");
lockPref("app.donation.eoy.version.viewed", 999);

/// Disable Filelink
// https://support.mozilla.org/kb/filelink-large-attachments

lockPref("mail.cloud_files.enabled", false);

/// Disable "Chat" functionality

lockPref("mail.chat.enabled", false);

// 003 DISK AVOIDANCE

/// Disable caching, might reconsider since we clear cache on exit anyways

lockPref("mail.imap.use_disk_cache2", false);

/// Set website permissions to be session only [INVESTIGATE]

defaultPref("permissions.memory_only", true);

/// Fully disable browsing history [INVESTIGATE]

lockPref("places.history.enabled", false);

/// Enforce Private Browsing

lockPref("browser.privatebrowsing.autostart", true);
lockPref("mailnews.oauth.usePrivateBrowser", true);

/// Prevent logging chat history
// https://stackoverflow.com/questions/32155137/how-to-disable-chat-history-in-mozilla-thunderbird

lockPref("purple.logging.log_chats", false);
lockPref("purple.logging.log_ims", false);

/// Do not leak info in chat notifications by default

defaultPref("mail.chat.notification_info", 2);

// 004 GENERAL NETWORK HARDENING

/// Enforce using secure connections for Auto config

lockPref("mailnews.auto_config.fetchFromISP.sslOnly", true);
lockPref("mailnews.auto_config.guess.requireGoodCert", true); // [DEFAULT]
lockPref("mailnews.auto_config.guess.sslOnly", true);

/// Disable link previews

lockPref("mail.compose.add_link_preview", false);

// 005 UI

/// Always show full email addresses

lockPref("mail.showCondensedAddresses", false);

// 006 INFORMATION LEAKAGE

/// Never send read receipts

lockPref("mail.mdn.report.enabled", false);
lockPref("purple.conversations.im.send_read", false); // [CHAT]

/// Never send chat typing notifications

lockPref("purple.conversations.im.send_typing", false);

/// Never report chat idle status

lockPref("messenger.status.reportIdle", false);

/// Prevent sending user agent with emails, as it is unnecessary, not even defined in spec, & leaks information
// https://bugzilla.mozilla.org/show_bug.cgi?id=1114475

lockPref("mailnews.headers.sendUserAgent", false);
lockPref("mailnews.headers.useMinimalUserAgent", true); // [DEFAULT, DEFENSE IN DEPTH]

/// Prevent leaking system locale & date/time in replies

lockPref("mailnews.reply_header_authorwroteondate", "#1 wrote on #2 #3:");
lockPref("mailnews.reply_header_authorwrotesingle", "#1 wrote:");
lockPref("mailnews.reply_header_ondateauthorwrote", "On #2 #3, #1 wrote:")
lockPref("mailnews.reply_header_type", 1);

/// Prevent leaking spellcheck dictionary info
// https://bugzilla.mozilla.org/show_bug.cgi?id=1370217

lockPref("mail.suppress_content_language", true);

/// Prevent leaking locale & specific time through date header
// https://bugzilla.mozilla.org/show_bug.cgi?id=1603359

lockPref("mail.sanitize_date_header", true);

// 007 MISC. PRIVACY

/// Never load remote content in emails

lockPref("mailnews.message_display.disable_remote_image", true); // [DEFAULT]

/// Disable JavaScript, set with "pref" so that it can be overridden per session as needed for ex. email log-in

pref("javascript.enabled", false);

/// Disable Geolocation

lockPref("geo.enabled", false);
lockPref("geo.provider.network.url", "");
lockPref("geo.provider.use_corelocation", false);
lockPref("geo.provider.use_geoclue", false);
lockPref("geo.provider.use_gpsd", false);
lockPref("geo.provider.ms-windows-location", false); 

/// Enable & Enforce ETP Strict Features (ETP Strict is not available on Thunderbird)

lockPref("network.http.referer.disallowCrossSiteRelaxingDefault", true); // [DEFAULT]
lockPref("network.http.referer.disallowCrossSiteRelaxingDefault.pbmode", true); // [DEFAULT]
lockPref("network.http.referer.disallowCrossSiteRelaxingDefault.pbmode.top_navigation", true); // [DEFAULT]
lockPref("network.http.referer.disallowCrossSiteRelaxingDefault.top_navigation", true);
lockPref("privacy.bounceTrackingProtection.enabled", true); // [DEFAULT
lockPref("privacy.fingerprintingProtection", true);
lockPref("privacy.fingerprintingProtection.pbmode", true);
lockPref("privacy.partition.always_partition_third_party_non_cookie_storage", true); // [DEFAULT]
lockPref("privacy.partition.always_partition_third_party_non_cookie_storage.exempt_sessionstorage", false); // [DEFAULT]
lockPref("privacy.partition.bloburl_per_partition_key", true); // [DEFAULT]
lockPref("privacy.partition.network_state.ocsp_cache", true); // [DEFAULT]
lockPref("privacy.partition.network_state.ocsp_cache.pbmode", true); // [DEFAULT]
lockPref("privacy.query_stripping.enabled", true);
lockPref("privacy.query_stripping.enabled.pbmode", true);
lockPref("privacy.trackingprotection.cryptomining.enabled", true);
lockPref("privacy.trackingprotection.emailtracking.enabled", true);
lockPref("privacy.trackingprotection.emailtracking.pbmode.enabled", true); // [DEFAULT]
lockPref("privacy.trackingprotection.enabled", true);
lockPref("privacy.trackingprotection.fingerprinting.enabled", true);
lockPref("privacy.trackingprotection.pbmode.enabled", true); // [DEFAULT]
lockPref("privacy.trackingprotection.socialtracking.enabled", true);

/// Prevent leaking sensitive information from the Cardbook extension
// https://github.com/HorlogeSkynet/thunderbird-user.js/blob/master/user.js#L1231

lockPref("extensions.cardbook.useOnlyEmail", true);

/// Always notify when PGP is possible

lockPref("mail.openpgp.remind_encryption_possible", true); // [DEFAULT]

/// Use GnuPG if built-in RNP fails
// https://wiki.mozilla.org/Thunderbird:OpenPGP:Smartcards#Allow_the_use_of_external_GnuP

lockPref("mail.openpgp.allow_external_gnupg", true);

// 008 MISC. SECURITY

/// Sanitize HTML content
// https://www.bucksch.org/1/projects/mozilla/108153/

lockPref("mail.html_sanitize.drop_conditional_css", true); // [DEFAULT]
lockPref("mailnews.display.html_as", 3);
lockPref("rss.display.html_as", 3);

/// Enforce built-in phishing protection
// https://support.mozilla.org/kb/thunderbirds-scam-detection

lockPref("mail.phishing.detection.disallow_form_actions", true); // [DEFAULT]
lockPref("mail.phishing.detection.enabled", true); // [DEFAULT]

// 009 MISC.

/// Send emails in plaintext by default
// https://drewdevault.com/2016/04/11/Please-use-text-plain-for-emails.html

defaultPref("mail.html_compose", false);
defaultPref("mail.default_send_format", 1);
defaultPref("mail.identity.default.compose_html", false);

/// By default, load summary of RSS feeds instead of the full webpage & prevent loading additional webpage content

defaultPref("rss.message.loadWebPageOnSelect", 0);
defaultPref("rss.show.summary", 1);

/// Do not allow calendar to extract data from emails

lockPref("calendar.extract.service.enabled", false); // [DEFAULT]

/// Disable Web Notifications

lockPref("dom.webnotifications.enabled", false);

/// Kill Gecko Media Plugins

lockPref("media.gmp-manager.url", "");
lockPref("media.gmp-manager.url.override", "");